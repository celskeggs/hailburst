package rmap

import "testing"

// This uses the test patterns from
// http://spacewire.esa.int/content/Standard/documents/SpaceWire%20RMAP%20Protocol%20Draft%20F%204th%20Dec%202006.pdf

func crcTest(t *testing.T, input []byte, output uint8) {
	crc := RmapCrc8(input)
	if crc != output {
		t.Errorf("wrong CRC: %02x instead of %02x", crc, output)
	}
}

func TestRmapCRC1(t *testing.T) {
	crcTest(
		t,
		[]byte{
			0x01, 0x02, 0x03, 0x04,
			0x05, 0x06, 0x07, 0x08,
		},
		0xB0,
	)
}

func TestRmapCRC2(t *testing.T) {
	crcTest(
		t,
		[]byte{
			0x53, 0x70, 0x61, 0x63,
			0x65, 0x57, 0x69, 0x72,
			0x65, 0x20, 0x69, 0x73,
			0x20, 0x62, 0x65, 0x61,
			0x75, 0x74, 0x69, 0x66,
			0x75, 0x6C, 0x21, 0x21,
		},
		0x84,
	)
}

func TestRmapCRC3(t *testing.T) {
	crcTest(
		t,
		[]byte{
			0x10, 0x56, 0xC3, 0x95,
			0xA5, 0x75, 0x38, 0x63,
			0x2F, 0x86, 0x7B, 0x01,
			0x32, 0xDE, 0x35, 0x7A,
		},
		0x18,
	)
}
